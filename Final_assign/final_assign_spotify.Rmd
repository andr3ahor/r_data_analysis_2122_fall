---
title: "Birdbath_final assignment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

#Intro
Final assignment: Bird bath

The 2021-08-31 TidyTueday dataset is about song popularity on Spotify. There is only one dataset, it is called `commute`. Reproduce the plot below!

The data has not been screened on youtube.

See below as required:
    -Proper textual explanations, and commented code
    -Exploratory data analysis with useful visualizations
    -Testing of hypothesis by building statistical model(s)
    -Verifying that statistical tests are reliable and valid (e.g. residual diagnostics, assumption checks)
    
Az EDA után arra leszek kíváncsi, hogy milyen tényezők határozzák meg legjobban a popularitást /korreláció, majd lineáris regresszió. 
#Végül az elemzések alapján megpróbálok felállítani egy modellt erre.
    
#Dataset
```{r}
spotify_songs <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv')
library(tidyverse)
library(ggplot2)
library(ggcorrplot)
library(kableExtra)
library(knitr)
library(psych)
library(RColorBrewer)

```

#Tidy
```{r}
#A nagy adathalmazból kiválasztottam azokat a változókat, amikkel dolgozni szeretnék.
spotify.df <- subset(spotify_songs, select=c(2,3,4,7,8, 10,12:23))
spotify.df$track_album_release_date <- substr(spotify.df$track_album_release_date, 0, 4) #dátum redukálása évre


#Hangnem (mode) változó átkódolása: major =dúr, minor =moll
spotify.df <- spotify.df %>% mutate(mode = recode(mode, 
                                 "1" = "major",
                                 "0" = "minor"))

```
#EDA
```{r}
str(spotify.df)
summary(spotify.df)

#NA értékek: összes 10
colSums(is.na(spotify.df))

#Évek: 1957-2020 
spotify.df %>% 
  count(track_album_release_date, sort = TRUE)

spotify.df <- spotify.df %>% 
  rename(Year = track_album_release_date)

#Genre fajták és számuk
table(spotify.df$playlist_genre) #6 genre van: edm, latin, pop, r&b, rap, rock. Nagyjából hasonló számban.

#Popularitás eloszlása
summary(spotify.df$track_popularity)

ggplot(spotify.df) +
    aes(x = track_popularity) +
    geom_histogram(bins = 30L) + scale_color_manual(values=wes_palette(n=1, name="GrandBudapest1")) +
    theme_minimal()
```

#Popularitás eloszlások ábrázolása
```{r}
#install.packages("wesanderson")
library(wesanderson)

#Popularitás alakulása az évek során. A popularitás itt azt jelenti, hogy mennyire volt népszerű.
spotify.df %>% 
    sample_n(1000) %>%
    ggplot() + 
    aes(x=Year, y=track_popularity, color=mode) + 
    geom_point() +
    theme_minimal() +
    labs( title = 'Popularitás alakulása az évek során', subtitle = "(1957-2020)", y= "Popularitás", color = 'Hangnem') + 
    scale_x_discrete(name = NULL, breaks = scales::pretty_breaks(n= 7))

#Popularitás genre alapján, az évek során
spotify.df %>% 
    sample_n(1000) %>%
    ggplot() + 
    aes(x=Year, y=track_popularity, color= playlist_genre) + 
    geom_point() + 
    theme_minimal() +
    labs( title = 'Popularitás alakulása műfajok szerint', subtitle = "(1957-2020)",y= "Popularitás", color = 'Műfaj') +
    scale_x_discrete(name = NULL,breaks = scales::pretty_breaks(n= 7)) 
```


Választott bemeneti változók:
```{r}
# Dataset for LM
data <- subset(spotify.df, select=c(3,4,7,8, 10,12:18))

#outlier adatok /Cook, Mahabolis
boxplot(data[c(1, 3:12)]) # ez nagyon csúnya, de segít elindulni, hogy mit érdemes megnézni
ggplot(data) +
    aes(x = "", y = track_popularity) +
    geom_boxplot(fill = "#0c4c8a") +
    theme_minimal()

#ötlet:
df.m <- melt(df, id.var = "Label")

ggplot(data = df.m, aes(x=Label, y=value)) + 
```


#Előfeltételek 1: kollinearitás/multikoll. kizárása
```{r}

```

#Előfeltételek2: Szóráshomogenitás - ábra: point és line
```{r}

```

#Előfeltételek3: Lineritás prediktorok és kimeneti változó között/ Ellenőrizhető az elemzés során a predikált értékek és reziduális értékek, vagy a predikált értékek és kimeneti változó közötti kapcsolat plottolásával (elég az egyiket kikérni)
```{r}

```

#Reziduális hibák ne korreláljanak / Durbin-Watson test
```{r}

```

